<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <meta name="theme-color" content="#000000" />
  <!-- PWA -->
  <link rel="manifest" href="manifest.webmanifest" />
  <meta name="mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  <title>Contador KENSA</title>
  <style>
    html, body { margin:0; padding:0; height:100%; background:#000; color:#0f0; font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; }
    .app { height: 100dvh; display: flex; flex-direction: column; overscroll-behavior: none; }
    .blackbar { height: 58%; position: relative; background:#000; }
    .labels { position: absolute; top: 8px; width: 100%; display:flex; justify-content: space-between; color:#0f0; opacity:.85; padding: 0 12px; font-weight:700; font-size: clamp(12px, 2.6vw, 18px); pointer-events:none; letter-spacing: .06em; }
    .top { position:absolute; inset:0; display:grid; grid-template-columns: 1fr 1fr 1fr; align-items:center; justify-items:center; gap: 8px; padding: 6px 8px 48px; }
    .digit { font-variant-numeric: tabular-nums; font-size: clamp(36px, 14vw, 120px); line-height: 1; letter-spacing: 0.04em; text-shadow: 0 0 8px rgba(0,255,0,.5); }
    .controls { position:absolute; bottom: 8px; left: 0; right: 0; display:flex; justify-content:center; gap: 8px; }
    .btn { background:#111; color:#0f0; border:1px solid #0f0; padding: 10px 14px; border-radius: 10px; font-weight:700; }
    .touch { height: 42%; background:#2a2a2a; display:flex; align-items:center; justify-content:center; color:#ddd; user-select:none; -webkit-tap-highlight-color: transparent; touch-action: manipulation; font-size: clamp(16px, 4vw, 22px); text-align:center; padding: 0 10px; }
    .hint { opacity:.8 }
  </style>
</head>
<body>
  <div class="app" id="app">
    <div class="blackbar">
      <div class="labels"><span>KENSA</span><span>TOTAL</span></div>
      <div class="top">
        <div class="digit" id="c1">00</div>
        <div class="digit" id="c2">00</div>
        <div class="digit" id="c3">00</div>
      </div>
      <div class="controls">
        <button class="btn" id="reset">Zerar</button>
        <button class="btn" id="minus">-1</button>
        <button class="btn" id="plus">+1</button>
        <button class="btn" id="fs">Tela Cheia</button>
      </div>
    </div>
    <div class="touch" id="touch">
      Toque aqui para contar.<br>
      <span class="hint">Dica: instale como app (Adicionar à tela inicial) para sumir a barra do navegador.</span>
    </div>
  </div>

  <audio id="beep" preload="auto">
    <source src="completed.wav" type="audio/wav" />
  </audio>

  <script>
    // ----- Estado dos contadores -----
    let c1=0, c2=0, c3=0;

    // Ajuste fino de posição dos dígitos (em px)
    const ADJUST_Y_PX = -10; // pedido anterior
    for (const id of ["c1","c2","c3"]) {
      const el = document.getElementById(id);
      el.style.position = "relative";
      el.style.top = ADJUST_Y_PX + "px";
    }

    const el1 = document.getElementById("c1");
    const el2 = document.getElementById("c2");
    const el3 = document.getElementById("c3");
    const touch = document.getElementById("touch");
    const beep = document.getElementById("beep");

    function fmt(n){ return n.toString().padStart(2,"0"); }
    function render(){ el1.textContent = fmt(c1); el2.textContent = fmt(c2); el3.textContent = fmt(c3); }

    function playBeep(){
      try { beep.currentTime = 0; beep.play(); } catch(e) {}
    }

    function tick(delta=1){
      // garante incrementos/dec por 1
      c1 += delta;
      // Loop + rollover de 60
      while (c1 >= 60) { c1 -= 60; c2 += 1; playBeep(); }
      while (c1 < 0)   { c1 += 60; c2 = Math.max(0, c2-1); }
      if (c2 >= 60) { c2 = 0; c3 += 1; }
      if (c2 < 0)   { c2 = 59; c3 = Math.max(0, c3-1); }
      render();
    }

    // Botões (1 única vez)
    document.getElementById("plus").addEventListener("click", () => tick(+1), {passive:true});
    document.getElementById("minus").addEventListener("click", () => tick(-1), {passive:true});
    document.getElementById("reset").addEventListener("click", () => { c1=c2=c3=0; render(); }, {passive:true});

    // Área de toque (1 por toque)
    touch.addEventListener("click", () => tick(+1), {passive:true});

    async function goFullscreen(){
      const root = document.documentElement;
      if (!document.fullscreenElement && root.requestFullscreen) {
        try { await root.requestFullscreen(); } catch(e) {}
      }
      if (screen.orientation && screen.orientation.lock) {
        try { await screen.orientation.lock('landscape'); } catch(e) {}
      }
    }
    document.getElementById("fs").addEventListener("click", goFullscreen, {passive:true});
    // Primeiro toque também tenta fullscreen (sem repetir)
    touch.addEventListener("click", goFullscreen, {once:true, passive:true});

    // Service Worker para PWA/A2HS
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('./service-worker.js').catch(()=>{});
      });
    }

    render();
  </script>
</body>
</html>
