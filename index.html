<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1.0"/>
  <title>Kensa Contador</title>
  <style>
    @font-face{
      font-family:'DS-Digital';
      src:url('./DS-DIGIT.TTF') format('truetype');
      font-weight:normal; font-style:normal; font-display:swap;
    }
    :root{
      --bg:#000; --touch:#333;
      --amber:#FFD54F; --red:#FF4040; --lime:limegreen;
    }
    html,body{height:100%; margin:0;}
    body{
      background:var(--bg); color:var(--amber);
      /* rótulos/textos = fonte normal */
      font-family:system-ui,-apple-system,"Segoe UI",Roboto,Arial,sans-serif;
      display:flex; flex-direction:column;
      user-select:none; -webkit-tap-highlight-color:transparent;
    }
    .top{
      flex:1; display:grid; grid-template-columns:repeat(3,1fr);
      align-items:center; justify-items:center; padding-top:6vh; gap:min(2vw,16px);
    }
    .cell{text-align:center;}
    .label{
      margin-bottom:6px; font-size:min(5vw,28px);
      letter-spacing:.5px; white-space:nowrap; font-family:inherit;
    }
    .digit{
      font-family:'DS-Digital',monospace; /* só dígitos são digitais */
      font-size:min(18vw,160px); line-height:1; letter-spacing:2px; white-space:nowrap;
      color:var(--amber);
    }
    .touch-area{height:40vh; background:var(--touch); width:100%; touch-action:none;}
    .controls{display:flex; gap:10px; justify-content:center; align-items:center; padding:8px 0;}
    button{
      padding:6px 12px; border-radius:10px; border:1px solid #555;
      background:#111; color:var(--amber); font-size:16px; font-family:inherit;
    }
    .footer{
      color:var(--lime); font-size:12px; font-style:italic;
      text-align:right; padding:4px 8px;
      font-family:"Segoe UI",Roboto,Arial,sans-serif;
    }
    @keyframes blinkColor{0%,49%{color:var(--amber);}50%,100%{color:var(--red);}}
    .blink{animation:blinkColor 1s steps(1,end) infinite;}
  </style>
</head>
<body>
  <div class="top">
    <div class="cell">
      <div class="label">KENSA OK</div>
      <div id="c1" class="digit">00</div>
    </div>
    <div class="cell">
      <div class="label">PALLET OUT</div>
      <div id="c2" class="digit">00</div>
    </div>
    <div class="cell">
      <div class="label">KENSA TOTAL</div>
      <div id="c3" class="digit">000</div>
    </div>
  </div>

  <div id="touch" class="touch-area" role="button" aria-label="Área de toque"></div>

  <div class="controls">
    <button id="decrement">-1</button>
    <button id="fullscreen">Tela Cheia</button>
  </div>

  <div class="footer">by FTS/c.gtp</div>

  <script>
    // Estado
    let c1=0,c2=0,c3=0;

    // DOM
    const c1El=document.getElementById('c1');
    const c2El=document.getElementById('c2');
    const c3El=document.getElementById('c3');
    const touchArea=document.getElementById('touch');

    function updateDisplay(){
      c1El.textContent=String(c1).padStart(2,'0');
      c2El.textContent=String(c2).padStart(2,'0');
      c3El.textContent=String(c3).padStart(3,'0');
      // pisca C1 em 07–09,17–19,...,57–59
      const d=c1%10;
      const blink=(c1>0 && c1<60 && (d===7||d===8||d===9));
      if(blink) c1El.classList.add('blink');
      else { c1El.classList.remove('blink'); c1El.style.color=''; }
    }

    // Sons (minúsculas)
    const S={
      beep:new Audio('./beep.mp3'),
      beep10:new Audio('./beep-10.mp3'),
      complete:new Audio('./pallet-complete.mp3')
    };
    let audioUnlocked=false;
    async function unlockAudioOnce(){
      if(audioUnlocked) return; audioUnlocked=true;
      for(const a of Object.values(S)){
        try{ a.volume=0.0001; await a.play(); a.pause(); a.currentTime=0; a.volume=1; }catch(_){}
      }
    }
    function playOnce(key){
      const a=S[key]; if(!a) return;
      try{ a.pause(); a.currentTime=0; }catch(_){}
      a.play().catch(()=>{});
    }
    function soundForNext(next){
      if(next===60) return 'complete';
      if(next%10===0) return 'beep10';
      return 'beep';
    }

    // Incrementa
    function applyIncrement(){
      const next=c1+1;
      playOnce(soundForNext(next));

      // C3 soma a cada toque
      c3++; if(c3>999) c3=0;

      if(next<=60){
        c1=next;
      }else{
        // fechou 60: C1 -> 0; C2 +1
        c1=0; c2++; if(c2>99) c2=0;
      }
      updateDisplay();
    }

    // Decrementa
    function decrement(){
      // C3 retroage junto (até 0)
      if(c3>0) c3--;

      if(c1>0){
        c1--;
      }else if(c2>0){
        c1=59; c2--;
      }else{
        // já está no "zero lógico"
        c1=0;
      }
      updateDisplay();
    }

    // Long-press com confirmação nativa (robusta no file:// e http://)
    let pressTimer=null, downAt=0, longPressed=false;
    const LONG_MS=1500, TAP_MAX_MS=500;

    touchArea.addEventListener('pointerdown',()=>{
      unlockAudioOnce();
      longPressed=false; downAt=performance.now();
      clearTimeout(pressTimer);
      pressTimer=setTimeout(()=>{
        longPressed=true;
        // confirm robusto (S/N)
        const ok=confirm('Zerar tudo?');
        if(ok){ c1=0; c2=0; c3=0; updateDisplay(); }
      },LONG_MS);
    });

    touchArea.addEventListener('pointerup',()=>{
      const dt=performance.now()-downAt;
      clearTimeout(pressTimer);
      if(!longPressed && dt<TAP_MAX_MS) applyIncrement();
    });
    touchArea.addEventListener('pointerleave',()=>clearTimeout(pressTimer));
    touchArea.addEventListener('contextmenu',e=>e.preventDefault());

    // Botões
    document.getElementById('decrement').addEventListener('click',decrement);
    document.getElementById('fullscreen').addEventListener('click',()=>{
      if(!document.fullscreenElement) document.documentElement.requestFullscreen().catch(()=>{});
      else document.exitFullscreen().catch(()=>{});
    });

    updateDisplay();
  </script>
</body>
</html>
